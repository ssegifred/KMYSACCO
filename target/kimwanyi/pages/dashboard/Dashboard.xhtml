<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"
>
<h:head>
    <f:facet name="first">
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>

        <h:outputStylesheet name="primeflex/3.3.1/primeflex.css" library="webjars"/>
    <link rel="stylesheet" type="text/css" href="../../css/App.css" />
        <link rel="stylesheet" type="text/css" href="../../css/dash.css" />
    </f:facet>
    <style>
        .dialog-form {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .withdraw-content {
            background-color: #E9EFE8;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
</h:head>
<h:body class="bg-bluegray-50">
    <h:panelGroup rendered="#{not empty sessionScope.Member}">
    <div class="container">
    <div id="dashboard">

            <h:form>
                <p:growl id="messages"/>
                <p:menubar>
                <p:submenu label="Dashboard" icon="pi pi-bars">
                        <p:menuitem value="Home" icon="pi pi-home" />
                    <p:menuitem value="Get Loan" icon="pi-credit-card"/>
                        <p:menuitem value="Reports" icon="pi-database" />
                    </p:submenu>
                <p:divider layout="vertical" />
                    <p:submenu label="Settings" icon="pi pi-fw pi-cog" >
                        <p:menuitem value="Edit" icon="pi pi-user" outcome="#{navigation.memberedit}"/>
                    </p:submenu>
                    <p:divider layout="vertical" />
                    <p:submenu label="Transact" icon="pi pi-briefcase" >
                        <p:menuitem value="Withdrawal" icon="pi pi-database" onclick="showLoanForm(event)"/>
                        <p:menuitem value="Deposit" icon="pi pi-dollar" onclick="showDepositForm(event)"/>
                    </p:submenu>
                    <p:divider layout="vertical" />
                    <f:facet name="options">
                        <p:commandButton value="Logout" icon="pi pi-fw pi-sign-out" styleClass="ui-button-info" action="#{loginForm.logout()}"/>
                    </f:facet>
                </p:menubar>
            </h:form>
           <div class="inline align-content-evenly justify-content-start gap-8 px-6 mt-2 m-4">

    <div class="grid">
        <div class="col-12 md:col-6 lg:col-4">
            <div class="px-5 py-3 surface-card shadow-2 border-round">
                <i class="pi pi-wallet"></i>
                <div class="text-blue-600 font-medium line-height-3 mb-2"><b>Deposits</b></div>
                <div class="text-900 font-bold line-height-3 text-2xl mb-2"><h:outputText value="#{TransactionView.getDeposit()}" /></div>
                <p class="text-700 line-height-3 m-0">Total Amount deposited</p>
            </div>
        </div>
        <div class="col-12 md:col-6 lg:col-4 ">
            <div class="px-5 py-3 surface-card shadow-2 border-round">
                <i class="pi pi-dollar"></i>
                <div class="text-blue-600 font-medium line-height-3 mb-2"><b>Withdraws</b></div>
                <div class="text-900 font-bold line-height-3 text-2xl mb-2"><h:outputText value="#{TransactionView.getWithdrawals()}" /></div>
                <p class="text-700 line-height-3 m-0">Total Withdraws</p>
            </div>
        </div>
        <div class="col-12 md:col-6 lg:col-4">
            <div class="px-5 py-3 surface-card shadow-2 border-round">
                <i class="pi pi-briefcase"></i>
                <div class="text-blue-600 font-medium line-height-3 mb-2"><b>Balance</b></div>
                <div class="text-900 font-bold line-height-3 text-2xl mb-2"><h:outputText value="#{TransactionView.getBalance()}" /></div>
                <p class="text-700 line-height-3 m-0">Account Balance</p>
            </div>
        </div>
    </div>

</div>
            <h:form>
<div class="card">
<div class="flex justify-content-between">
   <div>
   </div>
   <div>
      
      <p:commandButton value="PDF" styleClass="mr-2 mb-2" >
          <p:dataExporter type="pdf" target="history" fileName="Transaction Statement" visibleOnly="true" includeHeaders="true"/>
      </p:commandButton>
   </div>
</div>
    <p:dataTable id="history" var="transact" widgetVar="dtHist" value="#{TransactionView.getAllTransactions()}" showGridlines="true" allowUnsorting="true" sortMode="single">
        <f:facet name="header">
            <div class="flex justify-content-between align-items-center">
                <div style="color: green;"><h4>Transaction History</h4></div>
                <span class="filter-container ui-input-icon-left"> <i class="pi pi-search"></i>
                    <p:inputText id="globalFilter" onkeyup="PF('dtHist').filter()" placeholder="Search" />
                 </span>
                <div>
                    <p:commandButton id="toggler" type="button" value="Columns" icon="pi pi-align-justify"/>
                    <p:columnToggler datasource="history" trigger="toggler">
                        <p:ajax />
                    </p:columnToggler>
                </div>
            </div>
        </f:facet>

        <p:column sortBy="#{transact.getTransactionDate()}" headerText="Date" filterBy="#{transact.getTransactionDate()}">
            <h:outputText value="#{transact.getTransactionDate()}" />
        </p:column>

        <p:column sortBy="#{transact.getAmount()}" headerText="Amount" filterBy="#{transact.getAmount()}">
            <h:outputText value="#{transact.getAmount()}" />
        </p:column>

        <p:column sortBy="#{transact.getType()}" headerText="Category" filterBy="#{transact.getType()}">
            <h:outputText value="#{transact.getType()}" />
        </p:column>
    </p:dataTable>
</div>
</h:form>

    <div id="footer">
        <h4 class =" text-center">About Us</h4>
                <p class="m-0"> We are a community-based financial institution that aims to provide financial services to our members and promote a culture of saving and responsible borrowing.</p>
                <h:outputText value="Â© 2023 KMY SACCO. All rights reserved." />
    </div>
        <div id="WithdrawForm" class="dialog-form" style="display: none;">
            <div class="withdraw-content">
                <h:form>
                    <div class="flex justify-content-center">
                        <p:graphicImage name="kimwany1.png" library="images" alt="image missing" width="100" height="100" />
                    </div>
                    <div style="color: #529381;"><h3>KMY SACCO Withdraw Form</h3></div>
                    <p>Amount:</p>
                    <p:inputText id="amountInput" value="#{accountbean.account.amount}"/>

                    <br/><br/>
                    <div class="flex justify-content-center gap-2">
                    <p:commandButton value="Apply"  action="#{accountbean.Withdrawal() }" onclick="submitLoanForm()"/>
                    <p:commandButton value="Close" onclick="hideLoanForm()" />
                    </div>
                </h:form>
            </div>
        </div>
        <div id="DepositForm" class="dialog-form" style="display: none;">
            <div class="withdraw-content">
                <h:form>
                    <div class="flex justify-content-center">
                        <p:graphicImage name="kimwany1.png" library="images" alt="image missing" width="100" height="100" />
                    </div>
                    <div style="color: #529381;"><h3>KMY SACCO Deposit Form</h3></div>
                    <p>Amount:</p>
                    <p:inputText  value="#{accountbean.account.amount}"/>
                    <br/><br/>
                    <div class="flex justify-content-center gap-2">
                        <p:commandButton value="Deposit" action="#{accountbean.Deposit()}" onclick="submitDepositForm()"/>
                        <p:commandButton value="Close" onclick="hideDepositForm()" />
                    </div>
                </h:form>
            </div>
        </div>
    </div>
    </div>
</h:panelGroup>
<h:panelGroup rendered="#{empty sessionScope.Member}">
    <p>Access denied. Please wait, you'll be redirected to the login page...</p>
    <script>
        setTimeout(function() {
            window.location.href = "#{request.contextPath}/#{navigation.login}";
        }, 2000); // 2000 milliseconds (2 seconds) delay before redirection
    </script>
</h:panelGroup>
    <script>
        function showLoanForm() {
            document.getElementById("WithdrawForm").style.display = "flex";
        }

        function hideLoanForm() {
            document.getElementById("WithdrawForm").style.display = "none";
        }

        function submitLoanForm(event) {
            event.preventDefault(); // Prevent default form submission

            // Add logic to submit the loan form data

            hideLoanForm();
        }
        function showDepositForm() {
            document.getElementById("DepositForm").style.display = "flex";
        }
        function hideDepositForm() {
            document.getElementById("DepositForm").style.display = "none";
        }

        function submitDepositForm(event) {
            event.preventDefault();

            hideLoanForm();
        }
    </script>

</h:body>
</html>